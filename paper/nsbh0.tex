
%% Beginning of file 'sample63.tex'
%%
%% Modified 2019 June
%%
%% This is a sample manuscript marked up using the
%% AASTeX v6.3 LaTeX 2e macros.
%%
%% AASTeX is now based on Alexey Vikhlinin's emulateapj.cls 
%% (Copyright 2000-2015).  See the classfile for details.

%% AASTeX requires revtex4-1.cls (http://publish.aps.org/revtex4/) and
%% other external packages (latexsym, graphicx, amssymb, longtable, and epsf).
%% All of these external packages should already be present in the modern TeX 
%% distributions.  If not they can also be obtained at www.ctan.org.

%% The first piece of markup in an AASTeX v6.x document is the \documentclass
%% command. LaTeX will ignore any data that comes before this command. The 
%% documentclass can take an optional argument to modify the output style.
%% The command below calls the preprint style which will produce a tightly 
%% typeset, one-column, single-spaced document.  It is the default and thus
%% does not need to be explicitly stated.
%%
%%
%% using aastex version 6.3
\documentclass[twocolumn]{aastex63}
\usepackage{amsmath,bm}

%% The default is a single spaced, 10 point font, single spaced article.
%% There are 5 other style options available via an optional argument. They
%% can be invoked like this:
%%
%% \documentclass[arguments]{aastex63}
%% 
%% where the layout options are:
%%
%%  twocolumn   : two text columns, 10 point font, single spaced article.
%%                This is the most compact and represent the final published
%%                derived PDF copy of the accepted manuscript from the publisher
%%  manuscript  : one text column, 12 point font, double spaced article.
%%  preprint    : one text column, 12 point font, single spaced article.  
%%  preprint2   : two text columns, 12 point font, single spaced article.
%%  modern      : a stylish, single text column, 12 point font, article with
%% 		  wider left and right margins. This uses the Daniel
%% 		  Foreman-Mackey and David Hogg design.
%%  RNAAS       : Preferred style for Research Notes which are by design 
%%                lacking an abstract and brief. DO NOT use \begin{abstract}
%%                and \end{abstract} with this style.
%%
%% Note that you can submit to the AAS Journals in any of these 6 styles.
%%
%% There are other optional arguments one can invoke to allow other stylistic
%% actions. The available options are:
%%
%%   astrosymb    : Loads Astrosymb font and define \astrocommands. 
%%   tighten      : Makes baselineskip slightly smaller, only works with 
%%                  the twocolumn substyle.
%%   times        : uses times font instead of the default
%%   linenumbers  : turn on lineno package.
%%   trackchanges : required to see the revision mark up and print its output
%%   longauthor   : Do not use the more compressed footnote style (default) for 
%%                  the author/collaboration/affiliations. Instead print all
%%                  affiliation information after each name. Creates a much 
%%                  longer author list but may be desirable for short 
%%                  author papers.
%% twocolappendix : make 2 column appendix.
%%   anonymous    : Do not show the authors, affiliations and acknowledgments 
%%                  for dual anonymous review.
%%
%% these can be used in any combination, e.g.
%%
%% \documentclass[twocolumn,linenumbers,trackchanges]{aastex63}
%%
%% AASTeX v6.* now includes \hyperref support. While we have built in specific
%% defaults into the classfile you can manually override them with the
%% \hypersetup command. For example,
%%
%% \hypersetup{linkcolor=red,citecolor=green,filecolor=cyan,urlcolor=magenta}
%%
%% will change the color of the internal links to red, the links to the
%% bibliography to green, the file links to cyan, and the external links to
%% magenta. Additional information on \hyperref options can be found here:
%% https://www.tug.org/applications/hyperref/manual.html#x1-40003
%%
%% Note that in v6.3 "bookmarks" has been changed to "true" in hyperref
%% to improve the accessibility of the compiled pdf file.
%%
%% If you want to create your own macros, you can do so
%% using \newcommand. Your macros should appear before
%% the \begin{document} command.
%%
\newcommand{\vdag}{(v)^\dagger}
\newcommand\aastex{AAS\TeX}
\newcommand\latex{La\TeX}

%% Reintroduced the \received and \accepted commands from AASTeX v5.2
%\received{June 1, 2019}
%\revised{January 10, 2019}
%\accepted{\today}
\received{}
\revised{}
\accepted{}
%% Command to document which AAS Journal the manuscript was submitted to.
%% Adds "Submitted to " the argument.
\submitjournal{ApJL}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% The following section outlines numerous optional output that
%% can be displayed in the front matter or as running meta-data.
%%
%% If you wish, you may supply running head information, although
%% this information may be modified by the editorial offices.
\shorttitle{NSB$H_0$}
\shortauthors{Feeney et al.}
%%
%% You can add a light gray and diagonal water-mark to the first page 
%% with this command:
%% \watermark{text}
%% where "text", e.g. DRAFT, is the text to appear.  If the text is 
%% long you can control the water-mark size with:
%% \setwatermarkfontsize{dimension}
%% where dimension is any recognized LaTeX dimension, e.g. pt, in, etc.
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% This is the end of the preamble.  Indicate the beginning of the
%% manuscript itself with \begin{document}.

\begin{document}

\title{Measuring the Hubble Constant with Neutron-Star-Black-Hole Mergers in the A+ Era}

\correspondingauthor{Stephen M. Feeney}
\email{stephen.feeney@ucl.ac.uk}

\author[0000-0003-2268-2519]{Stephen M. Feeney}
\affiliation{Department of Physics \& Astronomy, University College London, Gower Street, London WC1E 6BT, UK}
\author[0000-0002-0041-3783]{Daniel J. Mortlock}
\affiliation{Astrophysics Group, Imperial College London, Blackett Laboratory, Prince Consort Road, London SW7 2AZ, UK}
\affiliation{Department of Mathematics, Imperial College London, London SW7 2AZ, UK}
\affiliation{Department of Astronomy, Stockholm University, AlbaNova, SE-10691 Stockholm, Sweden}
\author[0000-0001-6573-7773]{Samaya M. Nissanke}
\affiliation{GRAPPA, Anton Pannekoek Institute for Astronomy and Institute of High-Energy Physics, University of Amsterdam, Science Park 904, 1098 XH Amsterdam, The Netherlands}
\affiliation{Nikhef, Science Park 105, 1098 XG Amsterdam, The Netherlands}
\author[0000-0002-2519-584X]{Hiranya V. Peiris}
\affiliation{Department of Physics \& Astronomy, University College London, Gower Street, London WC1E 6BT, UK}
\affiliation{Oskar Klein Centre for Cosmoparticle Physics, Department of Physics,
Stockholm University, AlbaNova, Stockholm SE-106 91, Sweden}

%% Mark off the abstract in the ``abstract'' environment. 
\begin{abstract}

The Astrophysical Journal Letters (ApJL) has a 250 word limit for the abstract.

\end{abstract}

%% Keywords should appear after the \end{abstract} command. 
%% See the online documentation for the full list of available subject
%% keywords and the rules for their use.
\keywords{editorials, notices --- 
miscellaneous --- catalogs --- surveys}

%% From the front matter, we move on to the body of the paper.
%% Sections are demarcated by \section and \subsection, respectively.
%% Observe the use of the LaTeX \label
%% command after the \subsection to give a symbolic KEY to the
%% subsection for cross-referencing in a \ref command.
%% You can use LaTeX's \ref and \label commands to keep track of
%% cross-references to sections, equations, tables, and figures.
%% That way, if you change the order of any elements, LaTeX will
%% automatically renumber them.
%%
%% We recommend that authors also use the natbib \citep
%% and \citet commands to identify citations.  The citations are
%% tied to the reference list via symbolic KEYs. The KEY corresponds
%% to the KEY in the \bibitem in the reference list below. 

\section{Introduction} \label{sec:intro}

%Restrictions:
%\begin{enumerate}
%	\item Main Text -- no more than 3500 words (not including appendices or other supplementary material)
%	\item Figures and Tables -- no more than 5 combined figures (each limited to 9 panels) and tables, e.g. 3 figures and 2 tables.
%	\item References -- no more than 50 references
%\end{enumerate}

The current expansion rate of the Universe -- the Hubble constant, or $H_0$ -- is at the center of a serious cosmological controversy. Measured directly in the local Universe by the SH0ES team's Cepheid-supernova distance ladder, it is found to be blah. Estimated in a cosmological-model-dependent fashion from the Planck satellite's observations of the cosmic microwave background's temperature and polarization anisotropies, it is found to be wah. This is a big ol' discrepancy.

There are two potential explanations here. The most exciting of the two derives from the model-dependence of the CMB constraint: could this discrepancy be due to novel physics missing from the $\Lambda$CDM model used in the Planck analysis? This has, understandably, let to a great amount of activity among theorists [cites], though consensus on a compelling theoretical explanation is yet to be reached. Arguably the strongest (least weak?) evidence points at modifications to the expansion history in the decade of scale factor preceding recombination [EDE, Knox\& Millea] (though see [hill etc.] for recent contradictory evidence).

The second, more prosaic explanation, is that there are undiagnosed analysis issues in the CMB or distance ladder data. There are two approaches here, both of which have been heavily undertaken by the field: search for undiagnosed systematic errors in the constituent datasets, and harness complementary independent datasets to verify the conclusions of the low- and high-redshift universes. On the systematics side, there have been loads of investigations into the Cepheid-SN distance ladder [Cardona, Follin, Feeney, Rigault and responses] and the CMB [Spergel, more?], none of which have found incontrovertible evidence warranting a change of conclusions. On the new data side of things, the high-z Universe is pretty much sorted: the inverse distance ladder agrees with the CMB very well, which is particularly convincing given entirely CMB-independent formulations. Low-z is a little less clear? Various distance ladders (MIRAs, tRGB controversy) and strong lensing (though again, controversy) generally back up the Cepheids. Clear that a completely independent measurement with same precision would be enormously helpful.

Here's where GWs come in. Combining GW detections, which yield distance estimates, with EM counterparts, it's possible to estimate $H_0$ assuming general relativity alone [Schutz, Holz, Samaya]. With the advent of detections from LIGO and Virgo, starting to do this, both directly in the one case where the counterpart is known (LVC) and statistically in the case where it is not (many). Prime candidate here is BNS, as counterparts expected and things much more precise [us x 2, chen]. BBH can also be useful (see recent papers on blah, but note association is not firm, and model-dependent). What hasn't been researched so much is NSBH. Discuss [Chen Vitale], and motivate what we're doing here. Full ranges of parameters. Different waveforms. EM selection. This is the focus of this paper.


\section{Simulations} \label{sec:sims}

In this work we simulate the results of a network of an Nth generation network, consisting of LIGO A+, Virgo something, KAGRA and LIGO India [cite noise curves] observing for five years, with a 50\% duty cycle. We assume a constant rest-frame  NSBH merger rate of 610 per year per cubic Gpc, and require a network signal-to-noise of at least 12 for detection.

We generate parameters from these distributions. We then take these parameters and calculate the ejecta mass (note this assumes aligned spins). Set a maximum redshift of blah (which we checked is sufficient). We assume that the GW detectors operate in concert with an electromagnetic followup program capable of detecting all mergers with ejecta mass greater than 0.01 $M_\odot$; the selection function is therefore not entirely based on the gravitational wave signal. To determine the impact of different physical effects on our results, we choose to simulate using two waveform approximants: IMRPhenom and SEOBNR (hereafter blah and wah). One does this, the other does that. As the SEOBNR waveform requires aligned spins, we choose to zero the x and y spin components (as opposed to, for example, sampling from a uniform spin z distribution). This feels like a better approximation to spins becoming aligned over time. Remember redshift and peculiar velocity distributions.

When simulating, we generate blah raw mergers, wah of which are detected in GWs for IMRPhenom/SEOBNR, and rah of which have sufficient ejecta to be detected in EM. X of these events are common to the two samples. The simulated BH masses and spin magnitudes of the SEOBNR population are shown in Figure~\ref{fig:pops} {\bf [relabel to undetected in GW/EM?]}. Here, mergers too weak to be detected in GW are displayed as hollow circles, and GW-detected mergers as filled circles. Mergers with ejecta mass below/above our EM detection threshold are colored purple/blue, respectively. Overlaid are three disruption lines, indicating the BH spins at which the ejecta mass reaches our minimum detection threshold for NS masses equal to the minimum (dot-dashed), mean (solid) and maximum (dashed) of their distribution. The plot for the IMRPhenom simulations is very similar, but with mergers filling the full range of the y-axis (as the x and y spins are non-zero).

\begin{figure*}[ht!]
\plotone{{pc_nsbh_pop_H1+_L1+_V1+_K1+_A1_d_32.0_mf_20.0_rf_14.0_dndz_rr_ubhmp_2.5_40.0_unsmp_1.0_2.4_bbhsp_seobnr_aligned_imp_sample_weighted_samples_disruption_line_in_out_comp}.pdf}
\caption{Blah.\label{fig:pops}}
\end{figure*}

\section{Methods} \label{sec:methods}

The probabilistic inference of the Hubble constant from merger catalogues has been described in detail in the literature [cites]. The final posterior we evaluate is given by
\begin{widetext}
\begin{align}
{\rm P}(H_0, q_0, \Gamma, \{z, v\} | N, \{\hat{\bm{h}}_+, \hat{\bm{h}}_\times, \hat{z}, \hat{v} \}, \rho_*, I) & \propto
{\rm P}(H_0, q_0, \Gamma | I) \exp \left( -\bar{N}[H_0, q_0, \Gamma, \rho_*] \right) \\
& \times \prod_{i = 1}^{N} \frac{\Gamma}{1 + z_i} \frac{{\rm d}V}{{\rm d}z}(H_0, q_0) {\rm P}(\hat{\bm{h}}_{+,i}, \hat{\bm{h}}_{\times,i} | d_L[z_i, H_0, q_0]) P(v_i|I) P(\hat{v}_i | v_i) P(\hat{z}_i | z_i), \nonumber
\end{align}
\end{widetext}
where I've dropped a bunch of fixed parameters, such as the noise curves, errors on observed peculiar velocities and redshifts, observation time (perhaps we can bundle all of these into a set $O$?). Brackets denote sets of quantities, bold denotes per-source vectors. For the purposes of learning about cosmology, the true redshifts and peculiar velocities are uninteresting, and so we marginalize over these parameters. The first PDF in the product is the gravitational-wave likelihood marginalized over all parameters ($\boldsymbol{\theta}$) other than the distance to the merger,
\begin{equation}
{\rm P}(\hat{\bm{h}}_{+,i}, \hat{\bm{h}}_{\times,i} | d_L) = \int {\rm d}\boldsymbol{\theta} \, {\rm P}(\boldsymbol{\theta},I) {\rm P}(\hat{\bm{h}}_{+,i}, \hat{\bm{h}}_{\times,i} | d_L, \boldsymbol{\theta}),
\label{eq:marge_like}
\end{equation}
where $\boldsymbol{\theta}$ consists of the merger's chirp mass, mass ratio, spin magnitudes and orientations (where appropriate), inclination, polarization angle, tidal deformability, and time and phase at coalescence.

We assume blah priors on cosmological and a population parameters, and the same priors as used in the generative model elsewhere.

We perform this inference in two parts, using two sampling methods. We first process each merger individually in order to obtain the marginalized likelihood Eq.~\ref{eq:marge_like}. We use bilby wrapped around pypolychord for these marginalized likelihoods, taking 1000 live points at a time and using bilby's marginalize\_phase, time and distance settings. Convergence is greatly improved by sampling chirp masses and mass ratios instead of component masses: we use interim priors that are uniform in chirp mass and mass ratio over the ranges permitted by our component-mass extrema, before importance-sampling pypolychord's outputs to reinstate our desired uniform component-mass priors. Each N-dimensional (M-dimensional SEOBNR) sampling run takes 1-2 weeks (4-7 days) to converge on a single WAH CPU.

Given the marginalized GW likelihoods, we use no-u-turn sampling as implemented by the pystan package to infer the cosmological ($H_0$, $q_0$) and population parameters ($\Gamma$). To use pystan, we must be able to sample all parameters from analytic distributions. We therefore perform a Gaussian Mixture Model fit, as implemented by the pomegranate Python package, to each merger's marginalized distance likelihood. We fit using an integer grid of 2-10 mixture components, repeating the fit 10 times at each grid point and using the Akaike Information Criterion to find a robust optimal GMM fit for each likelihood. To sample, we must also evaluate Nbardet, the expected number of detected mergers, at each sampled value of the cosmological and population parameters. We do so by calculating Nbardet on a 5x5 grid of $H_0$ and $q_0$ assuming our fiducial rate value, and interpolating the results using a 2D fourth-order interpolant; the dependence on the sampled rate is captured by multiplying the interpolation coefficients by $\Gamma/\Gamma_{\rm fid}$. The resulting 153/193-dimensional pystan inference runs take less than a minute to generate 20,000 well converged samples on a 3.1 GHz Intel Core i7 CPU.

\section{Results} \label{sec:results}

Start with the bottom line. Processing our simulated SEOBNR and IMRPhenom catalogues through our inference pipeline produces the cosmology and population parameter posteriors shown in Fig.~\ref{fig:cosmo}. In both cases, the recovered $H_0$, $q_0$ and rate posteriors are completely consistent with the ground truth values. The credible range on the near-Gaussian $H_0$ marginal posterior is $\pm 1.6$ km/s/Mpc for the SEOBNR waveform and $\pm 1.0$ km/s/Mpc for IMRPhenom, reflecting the ability for precessing spins to break the distance-inclination degeneracy [cite]. There is, of course, a sample-size effect, too,  In both cases, however, this is comparable to the current Cepheid-SN distance ladder precision, and NSBH populations (should they occur at rates and produce EM counterparts roughly matching our assumptions) will therefore strongly inform the outcome of the current Hubble constant tension, particularly when combined with BNS populations. The mergers are also informative about the deceleration parameter, $q_0$, shrinking its uncertainty from 0.5 to 0.32 or 0.26, depending on the waveform. This further implies that NSBH mergers are able to begin constraining parameters such as OmegaM or w (in the context of LCDM models), complementary to BBH results from higher redshifts [cite]. The merger rates are recovered with roughly 10\% precision.

\begin{figure*}[ht!]
\plottwo{{pc_nsbh_pop_H1+_L1+_V1+_K1+_A1_d_32.0_mf_20.0_rf_14.0_dndz_rr_ubhmp_2.5_40.0_unsmp_1.0_2.4_bbhsp_seobnr_aligned_gmm_fits_rate_cosmo_post_triangle_plot}.pdf}{{pc_nsbh_pop_H1+_L1+_V1+_K1+_A1_d_32.0_mf_20.0_rf_14.0_dndz_rr_ubhmp_2.5_40.0_unsmp_1.0_2.4_bbhsp_gmm_fits_rate_cosmo_post_triangle_plot}.pdf}
\caption{Blah.\label{fig:cosmo}}
\end{figure*}

Let's now look at the results for individual mergers in closer detail, starting with the RHS of Fig.~\ref{fig:pops}. This shows the typical constraints on individual mergers' BH masses and spin magnitudes when using the SEOBNR waveform. A selection of zoomed-in versions of these constraints for both the SEOBNR (red, filled) and IMRPhenom (grey, filled) waveforms can be found in the top row of Fig.~\ref{fig:waveforms}. The selection is the highest SNR event common to both samples (left), the IMRPhenom event whose spins are closest to aligned (right), and three other mergers whose posteriors illustrate the types of degeneracies present. These plots bode well for recovering information about the neutron-star equation of state from the position of the tidal disruption line, though this is the focus of future work. Information more pertinent to the question at hand can be found in the bottom row of Fig.~\ref{fig:waveforms}, in which we show the constraints on the distance and inclination of a selection of mergers, whose various signal-to-noise ratios are indicated in the top row. What is clear, here, is the importance of precession in breaking the distance-inclination degeneracy, particularly in high-SNR events. We illustrate this further by re-running the IMRPhenom cases assuming aligned spins, having set their x and y spin components to zero. These results are overlaid as dashed dark red contours. The distance-inclination degeneracies blow up for the highest-SNR events, which will have a clear impact on the population's ability to constrain $H_0$.

\begin{figure*}[ht!]
\plotone{{nsbh_pop_H1+_L1+_V1+_K1+_A1_d_32.0_mf_20.0_rf_14.0_dndz_rr_ubhmp_2.5_40.0_unsmp_1.0_2.4_bbhsp_aligned_imp_sample_weighted_samples_spin_z_mass_dis_inc_wf_comp}.pdf}
\caption{Posterior distributions for mergers simulated using the IMRPhenom waveform with precessing (grey filled) and aligned (dark red dashed) spins, and the SEOBNR waveform (red) with aligned spins. Each column depicts the distance, inclination, and black-hole mass and $z$-spin magnitude posteriors for a merger with true parameters indicated by black plus symbols (crosses where the true $z$-spin is negative). Shown are: (left) the merger with the highest signal-to-noise, (right) the two IMRPhenom mergers whose black-hole spins are closest to being aligned, and (center) two further mergers indicating the range of posteriors observed. \label{fig:waveforms}}
\end{figure*}


\section{Conclusions} \label{sec:conclusions}


\acknowledgments

We thank some people.

%% To help institutions obtain information on the effectiveness of their 
%% telescopes the AAS Journals has created a group of keywords for telescope 
%% facilities.
%
%% Following the acknowledgments section, use the following syntax and the
%% \facility{} or \facilities{} macros to list the keywords of facilities used 
%% in the research for the paper.  Each keyword is check against the master 
%% list during copy editing.  Individual instruments can be provided in 
%% parentheses, after the keyword, but they are not verified.

\vspace{5mm}

%% Similar to \facility{}, there is the optional \software command to allow 
%% authors a place to specify which programs were used during the creation of 
%% the manuscript. Authors should list each code and include either a
%% citation or url to the code inside ()s when available.

\software{numpy \citep{}, matplotlib \citep{}, lalsim \citep{}, bilby \citep{}, pypolychord \citep{}, pomegranate \citep{}, pystan \citep{}, getdist \citep{}}

%% Appendix material should be preceded with a single \appendix command.
%% There should be a \section command for each appendix. Mark appendix
%% subsections with the same markup you use in the main body of the paper.

%% Each Appendix (indicated with \section) will be lettered A, B, C, etc.
%% The equation counter will reset when it encounters the \appendix
%% command and will number appendix equations (A1), (A2), etc. The
%% Figure and Table counter will not reset.

\appendix

\section{Appendix information}

An appendix.

\bibliography{sample63}{}
\bibliographystyle{aasjournal}

%% This command is needed to show the entire author+affiliation list when
%% the collaboration and author truncation commands are used.  It has to
%% go at the end of the manuscript.
%\allauthors

%% Include this line if you are using the \added, \replaced, \deleted
%% commands to see a summary list of all changes at the end of the article.
%\listofchanges

\end{document}

% End of file `sample63.tex'.
